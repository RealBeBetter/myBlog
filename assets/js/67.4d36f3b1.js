(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{661:function(_,v,t){"use strict";t.r(v);var d=t(11),r=Object(d.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("p",[_._v("在编写项目的时候，通常会遇到很多情况下，需要实现统一登录入口。统一登录入口通常指的是：能够实现手机号、邮箱、用户名等信息登录，且共用一个登录入口。")]),_._v(" "),t("p",[_._v("这种登录方式现在属于一种主流的登录方式，除此之外，移动端通常还有本机号码一键登录。")]),_._v(" "),t("h2",{attrs:{id:"登录账号鉴别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录账号鉴别"}},[_._v("#")]),_._v(" 登录账号鉴别")]),_._v(" "),t("p",[_._v("鉴于各种登录账号（指的是手机号、邮箱、用户名等可以唯一鉴别用户的信息，以下统称登陆账号）的组成不一样，我们可以在后端对数据进行区分。")]),_._v(" "),t("p",[_._v("我们在后台对用户的数据进行记录，一般要使用一个数据表来进行存储。表结构类似这种"),t("code",[_._v("id|name|phone|email|nick_name|desc")]),_._v(" 。那么我们在规划登录的时候，设置了手机号和邮件均可登录，且要求统一登录入口，该如何进行设计呢？")]),_._v(" "),t("p",[_._v("在登录的时候，我们需要根据用户的输入来判断用户登录使用的是什么登录账号。如果使用的是手机号，我们可以根据用户的输入（国内用户）判断是否为电话号码（数字/长度）；如果使用的是邮箱，可以用特殊标识（"),t("code",[_._v("@/.")]),_._v("）来判断。但是这类的判断方法存在缺陷，如果还存在可以使用用户名进行登录的方式，需要进行各种验证，逻辑比较复杂，最终可能还需要进行登录字段的遍历操作。")]),_._v(" "),t("p",[_._v("如果使用初始字段进行登录设计，后续如果添加了一种登录方式，需要对数据库进行字段添加操作，修改困难，维护不便。所以，直接使用用户表进行统一登录功能的实现，并不灵活。")]),_._v(" "),t("ol",[t("li",[_._v("判断登录方式逻辑复杂")]),_._v(" "),t("li",[_._v("后续扩展便捷性差")])]),_._v(" "),t("h2",{attrs:{id:"数据库字段鉴别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库字段鉴别"}},[_._v("#")]),_._v(" 数据库字段鉴别")]),_._v(" "),t("p",[_._v("在数据库的设计上，"),t("strong",[_._v("加记录比加字段更容易扩展")]),_._v("。我们可以在登录的时候，创建一张专门用于维护登录的表，命名为 login_ticket 。在字段的设计上，我们可以记录：")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("字段名")]),_._v(" "),t("th",[_._v("类型")]),_._v(" "),t("th",[_._v("备注")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("id")]),_._v(" "),t("td",[_._v("int/bigint")]),_._v(" "),t("td",[_._v("表格数据段唯一标识")])]),_._v(" "),t("tr",[t("td",[_._v("user_id")]),_._v(" "),t("td",[_._v("int/bigint")]),_._v(" "),t("td",[_._v("用户iD，关联用户表用户ID")])]),_._v(" "),t("tr",[t("td",[_._v("user_name")]),_._v(" "),t("td",[_._v("varchar(255)")]),_._v(" "),t("td",[_._v("用户名，用于登录时显示")])]),_._v(" "),t("tr",[t("td",[_._v("login_type")]),_._v(" "),t("td",[_._v("int")]),_._v(" "),t("td",[_._v("登录方式，规定每一个值代表何种登录方式")])]),_._v(" "),t("tr",[t("td",[_._v("password")]),_._v(" "),t("td",[_._v("varchar(255)")]),_._v(" "),t("td",[_._v("用户密码，如果第三方登录则记录 token")])])])]),_._v(" "),t("p",[_._v("之后，我们就可以在 user 表中只存储和登录无关的字段信息了。例如如下设计：")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("字段名")]),_._v(" "),t("th",[_._v("类型")]),_._v(" "),t("th",[_._v("备注")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("id")]),_._v(" "),t("td",[_._v("int/bigint")]),_._v(" "),t("td",[_._v("用户唯一标识")])]),_._v(" "),t("tr",[t("td",[_._v("nick_name")]),_._v(" "),t("td",[_._v("varchar(255)")]),_._v(" "),t("td",[_._v("用户昵称")])]),_._v(" "),t("tr",[t("td",[_._v("avatar_url")]),_._v(" "),t("td",[_._v("varchar(255)")]),_._v(" "),t("td",[_._v("用户头像路径")])]),_._v(" "),t("tr",[t("td",[_._v("user_names")]),_._v(" "),t("td",[_._v("varchar(255)")]),_._v(" "),t("td",[_._v("用户的所有登录方式")])])])]),_._v(" "),t("p",[_._v("这样，我们就得到容易扩展的记录登录方式的数据表了。如果需要增加登录方式，只需要增加 login_ticket 表格中的数据即可。")]),_._v(" "),t("p",[_._v("例如：")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("在 user 表中，我们存储的数据为：")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("id")]),_._v(" "),t("th",[_._v("nick_name")]),_._v(" "),t("th",[_._v("avatar_url")]),_._v(" "),t("th",[_._v("user_names")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("1")]),_._v(" "),t("td",[_._v("Real")]),_._v(" "),t("td",[_._v("/avartar/Real.jpg")]),_._v(" "),t("td")])])])]),_._v(" "),t("li",[t("p",[_._v("在 login_ticket 表中，我们存储的数据为：")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("id")]),_._v(" "),t("th",[_._v("user_id")]),_._v(" "),t("th",[_._v("user_name(登录账户)")]),_._v(" "),t("th",[_._v("login_type")]),_._v(" "),t("th",[_._v("password")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("10001")]),_._v(" "),t("td",[_._v("1")]),_._v(" "),t("td",[t("code",[_._v("12345678910")])]),_._v(" "),t("td",[_._v("0（邮箱）")]),_._v(" "),t("td",[_._v("123456")])]),_._v(" "),t("tr",[t("td",[_._v("10002")]),_._v(" "),t("td",[_._v("1")]),_._v(" "),t("td",[t("code",[_._v("xxx@qq.com")])]),_._v(" "),t("td",[_._v("1（手机号）")]),_._v(" "),t("td",[_._v("123456")])])])])])]),_._v(" "),t("p",[_._v("有了这样的实际数据之后，我们如果新增登录方式，也可以通过添加字段来直接实现。但是一个 user 是存在多个字段的，那么修改密码，是需要将所有 user_id 相同的字段都修改密码的。")]),_._v(" "),t("p",[_._v("所以在具体的项目中，需要优先使用第二种方式来实现多种方式登录操作。如果项目数据比较大，我们还可以进行数据库的分库分表操作来完成数据库的访问优化。")])])}),[],!1,null,null,null);v.default=r.exports}}]);